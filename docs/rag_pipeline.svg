<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 560" width="800" height="560">
  <defs>
    <linearGradient id="bg" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#0f172a"/>
      <stop offset="100%" style="stop-color:#1e293b"/>
    </linearGradient>
    <marker id="arr" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#94a3b8"/>
    </marker>
    <marker id="arrG" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#4ade80"/>
    </marker>
    <marker id="arrR" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#f87171"/>
    </marker>
  </defs>

  <rect width="800" height="560" fill="url(#bg)" rx="14"/>
  <text x="400" y="34" font-family="'Segoe UI', Arial, sans-serif" font-size="19" font-weight="700"
        text-anchor="middle" fill="#e2e8f0">RAG Pipeline â€” Ingest &amp; Query</text>

  <!-- ===== LEFT: INGESTION PIPELINE ===== -->
  <text x="200" y="68" font-family="'Segoe UI', Arial" font-size="14" font-weight="700"
        text-anchor="middle" fill="#fbbf24">ğŸ“¥ Document Ingestion</text>

  <!-- Step 1: Files -->
  <rect x="60" y="80" width="280" height="54" rx="8" fill="#1c1917" stroke="#f59e0b" stroke-width="1.5"/>
  <text x="200" y="103" font-family="monospace" font-size="12" font-weight="700" text-anchor="middle" fill="#fde68a">ğŸ“„ Source Files</text>
  <text x="200" y="121" font-family="monospace" font-size="10" text-anchor="middle" fill="#d97706">PDF  Â·  TXT  Â·  Markdown</text>

  <!-- Arrow -->
  <line x1="200" y1="134" x2="200" y2="156" stroke="#f59e0b" stroke-width="2" marker-end="url(#arr)"/>
  <text x="215" y="149" font-family="monospace" font-size="9" fill="#d97706">read file</text>

  <!-- Step 2: Chunker -->
  <rect x="60" y="158" width="280" height="54" rx="8" fill="#1c1917" stroke="#f59e0b" stroke-width="1.5"/>
  <text x="200" y="181" font-family="monospace" font-size="12" font-weight="700" text-anchor="middle" fill="#fde68a">âœ‚ï¸ Text Chunker</text>
  <text x="200" y="199" font-family="monospace" font-size="10" text-anchor="middle" fill="#d97706">~500 words per chunk  Â·  configurable</text>

  <!-- Arrow -->
  <line x1="200" y1="212" x2="200" y2="234" stroke="#f59e0b" stroke-width="2" marker-end="url(#arr)"/>
  <text x="215" y="227" font-family="monospace" font-size="9" fill="#d97706">chunk list</text>

  <!-- Step 3: Embedder -->
  <rect x="60" y="236" width="280" height="54" rx="8" fill="#1c1917" stroke="#f59e0b" stroke-width="1.5"/>
  <text x="200" y="259" font-family="monospace" font-size="12" font-weight="700" text-anchor="middle" fill="#fde68a">ğŸ”¢ Sentence Embedder</text>
  <text x="200" y="277" font-family="monospace" font-size="10" text-anchor="middle" fill="#d97706">all-MiniLM-L6-v2  Â·  384-dim float32</text>

  <!-- Arrow down-left to hnswlib -->
  <line x1="140" y1="290" x2="90" y2="340" stroke="#f59e0b" stroke-width="2" marker-end="url(#arr)"/>
  <text x="92" y="322" font-family="monospace" font-size="9" fill="#d97706">vectors</text>

  <!-- Arrow down-right to SQLite -->
  <line x1="260" y1="290" x2="310" y2="340" stroke="#f59e0b" stroke-width="2" marker-end="url(#arr)"/>
  <text x="280" y="322" font-family="monospace" font-size="9" fill="#d97706">metadata</text>

  <!-- Step 4a: hnswlib -->
  <rect x="30" y="342" width="160" height="80" rx="8" fill="#1c1917" stroke="#fbbf24" stroke-width="2"/>
  <text x="110" y="364" font-family="monospace" font-size="11" font-weight="700" text-anchor="middle" fill="#fbbf24">ğŸ—‚ hnswlib</text>
  <text x="110" y="382" font-family="monospace" font-size="9" text-anchor="middle" fill="#d97706">vectors.bin</text>
  <text x="110" y="396" font-family="monospace" font-size="9" text-anchor="middle" fill="#d97706">HNSW index</text>
  <text x="110" y="410" font-family="monospace" font-size="9" text-anchor="middle" fill="#d97706">cosine space</text>

  <!-- Step 4b: SQLite -->
  <rect x="210" y="342" width="160" height="80" rx="8" fill="#1c1917" stroke="#fbbf24" stroke-width="2"/>
  <text x="290" y="364" font-family="monospace" font-size="11" font-weight="700" text-anchor="middle" fill="#fbbf24">ğŸ—ƒ SQLite</text>
  <text x="290" y="382" font-family="monospace" font-size="9" text-anchor="middle" fill="#d97706">chunks.sqlite3</text>
  <text x="290" y="396" font-family="monospace" font-size="9" text-anchor="middle" fill="#d97706">id Â· source</text>
  <text x="290" y="410" font-family="monospace" font-size="9" text-anchor="middle" fill="#d97706">chunk_idx Â· content</text>

  <!-- JSON meta -->
  <rect x="100" y="440" width="200" height="50" rx="8" fill="#1c1917" stroke="#fbbf24" stroke-width="1"/>
  <text x="200" y="461" font-family="monospace" font-size="11" font-weight="700" text-anchor="middle" fill="#fbbf24">ğŸ“‹ index_meta.json</text>
  <text x="200" y="479" font-family="monospace" font-size="9" text-anchor="middle" fill="#d97706">max_elements Â· current_count Â· dimension</text>
  <line x1="110" y1="422" x2="150" y2="440" stroke="#d97706" stroke-width="1" stroke-dasharray="4,2"/>
  <line x1="290" y1="422" x2="250" y2="440" stroke="#d97706" stroke-width="1" stroke-dasharray="4,2"/>

  <!-- ===== DIVIDER ===== -->
  <line x1="410" y1="55" x2="410" y2="510" stroke="#334155" stroke-width="1.5" stroke-dasharray="8,4"/>
  <text x="410" y="530" font-family="'Segoe UI', Arial" font-size="10" text-anchor="middle" fill="#475569">â€” â€” â€”</text>

  <!-- ===== RIGHT: QUERY PIPELINE ===== -->
  <text x="610" y="68" font-family="'Segoe UI', Arial" font-size="14" font-weight="700"
        text-anchor="middle" fill="#22c55e">ğŸ” Query / Retrieval</text>

  <!-- User Query -->
  <rect x="460" y="80" width="280" height="54" rx="8" fill="#052e16" stroke="#22c55e" stroke-width="1.5"/>
  <text x="600" y="103" font-family="monospace" font-size="12" font-weight="700" text-anchor="middle" fill="#86efac">ğŸ’¬ User Query</text>
  <text x="600" y="121" font-family="monospace" font-size="10" text-anchor="middle" fill="#4ade80">"What does the doc say about X?"</text>

  <!-- Arrow -->
  <line x1="600" y1="134" x2="600" y2="156" stroke="#22c55e" stroke-width="2" marker-end="url(#arrG)"/>

  <!-- Embed query -->
  <rect x="460" y="158" width="280" height="54" rx="8" fill="#052e16" stroke="#22c55e" stroke-width="1.5"/>
  <text x="600" y="181" font-family="monospace" font-size="12" font-weight="700" text-anchor="middle" fill="#86efac">ğŸ”¢ Embed Query</text>
  <text x="600" y="199" font-family="monospace" font-size="10" text-anchor="middle" fill="#4ade80">same model â†’ float32 vector</text>

  <!-- Arrow -->
  <line x1="600" y1="212" x2="600" y2="234" stroke="#22c55e" stroke-width="2" marker-end="url(#arrG)"/>

  <!-- knn_query -->
  <rect x="460" y="236" width="280" height="54" rx="8" fill="#052e16" stroke="#22c55e" stroke-width="1.5"/>
  <text x="600" y="259" font-family="monospace" font-size="12" font-weight="700" text-anchor="middle" fill="#86efac">ğŸ¯ knn_query (hnswlib)</text>
  <text x="600" y="277" font-family="monospace" font-size="10" text-anchor="middle" fill="#4ade80">top_k=3 nearest neighbors</text>

  <!-- Arrow -->
  <line x1="600" y1="290" x2="600" y2="312" stroke="#22c55e" stroke-width="2" marker-end="url(#arrG)"/>

  <!-- Fetch from SQLite -->
  <rect x="460" y="314" width="280" height="54" rx="8" fill="#052e16" stroke="#22c55e" stroke-width="1.5"/>
  <text x="600" y="337" font-family="monospace" font-size="12" font-weight="700" text-anchor="middle" fill="#86efac">ğŸ“‹ Fetch Chunks (SQLite)</text>
  <text x="600" y="355" font-family="monospace" font-size="10" text-anchor="middle" fill="#4ade80">source Â· chunk_index Â· content</text>

  <!-- Arrow -->
  <line x1="600" y1="368" x2="600" y2="390" stroke="#22c55e" stroke-width="2" marker-end="url(#arrG)"/>

  <!-- Build Prompt -->
  <rect x="460" y="392" width="280" height="54" rx="8" fill="#052e16" stroke="#22c55e" stroke-width="1.5"/>
  <text x="600" y="415" font-family="monospace" font-size="12" font-weight="700" text-anchor="middle" fill="#86efac">ğŸ“ Build RAG Prompt</text>
  <text x="600" y="433" font-family="monospace" font-size="9" text-anchor="middle" fill="#4ade80">[source #N] content ... User: ... Assistant:</text>

  <!-- Arrow -->
  <line x1="600" y1="446" x2="600" y2="468" stroke="#22c55e" stroke-width="2" marker-end="url(#arrG)"/>

  <!-- LLM generate -->
  <rect x="460" y="470" width="280" height="40" rx="8" fill="#052e16" stroke="#22c55e" stroke-width="2"/>
  <text x="600" y="495" font-family="monospace" font-size="12" font-weight="700" text-anchor="middle" fill="#4ade80">ğŸ–¥ llama.cpp â†’ Response</text>

  <!-- Score legend -->
  <rect x="20" y="510" width="360" height="36" rx="6" fill="#1e293b" stroke="#334155" stroke-width="1"/>
  <text x="200" y="527" font-family="'Segoe UI', Arial" font-size="10" font-weight="700" text-anchor="middle" fill="#94a3b8">Distance score (cosine): lower = more similar</text>
  <text x="200" y="542" font-family="monospace" font-size="9" text-anchor="middle" fill="#64748b">0.0 = identical  Â·  1.0 = orthogonal  Â·  2.0 = opposite</text>
</svg>
